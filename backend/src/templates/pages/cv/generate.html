{% extends "base/base.html" %}
{% load static %}

{% block title %}Generate CV{% endblock %}

{% block content %}

{% include "pages/cv/page_title.html" with title="Generate CV" icon="file-text" %}

<div class="container-xl px-4">

    {% include "pages/cv/_nav.html" with active_tab="generate" %}

    <!-- ===============================
         THEME SELECTOR
    ================================ -->
    <div class="card mb-4">
        <div class="card-header">Pilih Tema CV</div>
        <div class="card-body">

            <div class="row align-items-center">

                <div class="col-md-4">
                    <label class="form-label fw-bold">Tema</label>
                    <select id="themeSelect" class="form-select" onchange="changeTheme()">
                        <option value="professional">Professional</option>
                        <option value="simple">Simple</option>
                        <option value="modern">Modern</option>
                        <option value="corporate">Corporate</option>
                        <option value="creative">Creative</option>
                    </select>
                </div>

            </div>

        </div>
    </div>

    <!-- ===============================
         PREVIEW
    ================================ -->
    <div class="card mb-4">
        <div class="card-header">Preview CV</div>
        <div class="card-body">
            <iframe id="previewFrame"
                    style="width:100%; height:650px; border:1px solid #ccc;"></iframe>
        </div>
    </div>

    <!-- ===============================
         DOWNLOAD
    ================================ -->
    <div class="text-end mb-5">
        <button class="btn btn-primary" onclick="downloadCV()">Download PDF</button>
    </div>

</div>

<script>
let userId = "{{ request.user.id }}";
let selectedTheme = "professional";

// Load default preview on page load
window.onload = function() {
    updatePreview(selectedTheme);
};

// Change theme via dropdown
function changeTheme() {
    const theme = document.getElementById("themeSelect").value;
    selectedTheme = theme;
    updatePreview(theme);
}

// Update iframe preview
function updatePreview(theme) {
    const url = `/api/cv/generator/${userId}/generate/?theme=${theme}&mode=preview`;
    document.getElementById("previewFrame").src = url;
}

// Download PDF
function downloadCV() {
    const url = `/api/cv/generator/${userId}/generate/?theme=${selectedTheme}&mode=download`;
    window.open(url, "_blank");
}
</script>

{% endblock %}
